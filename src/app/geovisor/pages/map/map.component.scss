/*
 * :host es el selector para el propio componente <app-map>.
 * Lo configuramos para que ocupe toda la pantalla de una manera robusta
 * que funciona mejor que '100vh' en móviles.
*/
:host {
  display: block;
  width: 100%;
  /*
   * Solución definitiva para el ancho y alto en iOS/Safari.
   * '100dvh' (dynamic viewport height) se ajusta dinámicamente cuando las barras
   * del navegador aparecen o desaparecen, a diferencia de '100vh'.
   * '100vw' (viewport width) asegura que el ancho no se expanda.
   * '100%' se mantiene como fallback para navegadores más antiguos.
  */
  max-width: 100vw;
  height: 100%;
  height: 100dvh;
  overflow: hidden;
  position: relative;
}

.map-container {
  width: 100%;
  height: 100%;
  overflow: hidden; /* Refuerzo: Asegura que el contenedor del mapa no se desborde */
  position: relative;
}

.map-view {
  width: 100%;
  height: 100%;
  position: absolute;

  inset: 0;
  /*
   * Mejora el rendimiento de los gestos en el mapa y evita
   * conflictos con los gestos del navegador (ej. pull-to-refresh).
  */
  touch-action: none;

  /*
   * Solución para el error de renderizado de "espejo" en algunas versiones de Chrome para Android.
   * - `direction: ltr` asegura la dirección de renderizado de izquierda a derecha.
   * - `transform: translateZ(0)` fuerza la aceleración por hardware (GPU), lo que
   *   a menudo resuelve bugs de renderizado en navegadores móviles.
   * - `backface-visibility: hidden` es otra técnica para forzar la composición en la GPU.
  */
  direction: ltr;
  -webkit-transform: translateZ(0);
  transform: translateZ(0);
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
}

/*
 * Usamos ::ng-deep para aplicar estilos a los componentes hijos
 * desde el padre. Esto es necesario para ajustar su posición
 * respetando las áreas seguras del iPhone.
*/

::ng-deep {
  /*
   * Bloqueo global para `html` y `body` para prevenir desbordamientos
   * a nivel de documento, una causa común de problemas en Safari.
  */
  html, body {
    width: 100%;
    height: 100%;
    overflow: hidden !important;
  }

  /* Ajusta la barra de navegación superior */
  app-navbar {
    /*
     * Hacemos que el componente anfitrión sea el elemento fijo.
     * Esto es más estable en Safari que tener un elemento fijo anidado.
    */
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 10;
    overflow-x: hidden; /* Contiene cualquier desbordamiento del buscador */

    .navbar-container {
      // Aplica padding para respetar todas las áreas seguras del iPhone (notch, isla, barra de gestos).
      padding-top: env(safe-area-inset-top, 1rem);
      padding-left: env(safe-area-inset-left, 1rem);
      padding-right: env(safe-area-inset-right, 1rem);
    }
  }

  /* Ajusta el contenedor de botones flotantes */
  app-fab-container-top {
    .fab-container {
      // Ajusta la posición para respetar las áreas seguras superior y derecha.
      top: env(safe-area-inset-top, 1rem);
      right: env(safe-area-inset-right, 1rem);
    }
  }

  /* Ajusta el componente de información de coordenadas */
  app-info-coordenadas {
    .info-coordenadas-container {
      // Añade padding para respetar las áreas seguras en la parte inferior y los lados.
      padding-bottom: env(safe-area-inset-bottom, 1rem);
      padding-left: env(safe-area-inset-left, 1rem);
      padding-right: env(safe-area-inset-right, 1rem);
    }
  }
}
